define(["require","jquery","selectize"],function(e){var t=e("jquery"),n=e("selectize"),r=t("[data-selectize]"),i=r.closest("form"),s=r.data("selectize"),o=r.data("url"),u=r.data("max-items"),a=r.data("max-options");r.selectize({valueField:"id",labelField:s,searchField:[s],maxItems:u,maxOptions:a,options:[],create:!1,render:{option:function(e,t){return"<div>"+t(e[s])+"</div>"}},load:function(e,n){data={},data[s]=e,t.ajax({url:o,dataType:"json",data:data,error:function(){console.log("error fetching "+s+" from "+o),n()},success:function(e){var r=t.map(e.data,function(e,t){return{value:t,text:e}});n(r)}})}}),i.submit(function(){var e=r.val().split(",");e.forEach(function(e){t("<input />").attr("type","hidden").attr("name",r.attr("name")+"[]").attr("value",e).appendTo(i)}),r.remove()})});